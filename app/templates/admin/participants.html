{% extends "base.html" %}
{% block title %}Participants — {{ experiment.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 data-bs-toggle="tooltip" data-bs-placement="bottom"
        title="All people who have started this experiment. Click on a session badge to explore the full interaction timeline for that session.">
        Participants: {{ experiment.name }}
    </h2>
    <div>
        <a href="{{ url_for('admin.analytics', experiment_id=experiment.id) }}" class="btn btn-outline-info btn-sm"
           data-bs-toggle="tooltip" title="Go to the analytics dashboard with charts, summary statistics, and the session explorer.">
            Analytics
        </a>
        <a href="{{ url_for('admin.experiment_edit', experiment_id=experiment.id) }}" class="btn btn-outline-secondary btn-sm ms-1">Back to Experiment</a>
    </div>
</div>

{% if participants %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th data-bs-toggle="tooltip" title="The name entered by the participant at the start of the experiment.">Name</th>
                <th data-bs-toggle="tooltip" title="Unique identifier automatically assigned to each participant.">UUID</th>
                <th data-bs-toggle="tooltip" title="Email address (if provided).">Email</th>
                <th data-bs-toggle="tooltip" title="Additional demographic data collected from the participant.">Demographics</th>
                <th data-bs-toggle="tooltip" title="Session status. Click a badge to open the Session Explorer for that session — see the full timeline, events, and results.">Sessions</th>
                <th data-bs-toggle="tooltip" title="When this participant first started the experiment.">Created</th>
            </tr>
        </thead>
        <tbody>
            {% for p in participants %}
            <tr>
                <td><strong>{{ p.name }}</strong></td>
                <td><code class="small" data-bs-toggle="tooltip" title="Full UUID: {{ p.uuid }}">{{ p.uuid[:8] }}...</code></td>
                <td>{{ p.email or '-' }}</td>
                <td>
                    {% set demo = p.get_demographics() %}
                    {% if demo and demo != '{}' %}
                    <small data-bs-toggle="tooltip" title="Raw demographics data: {{ demo }}">{{ demo }}</small>
                    {% else %}-{% endif %}
                </td>
                <td>
                    {% for s in sessions.get(p.id, []) %}
                    <a href="{{ url_for('admin.session_detail', experiment_id=experiment.id, session_id=s.id) }}"
                       class="badge bg-{{ 'success' if s.completed_at else 'warning' }} text-decoration-none"
                       data-bs-toggle="tooltip"
                       title="Session #{{ s.id }} — click to explore full timeline and results{% if s.completed_at %} (completed {{ s.completed_at.strftime('%Y-%m-%d %H:%M') }}){% else %} (in progress){% endif %}">
                        {{ 'Completed' if s.completed_at else 'In Progress' }}
                    </a>
                    {% endfor %}
                </td>
                <td>{{ p.created_at.strftime('%Y-%m-%d %H:%M') if p.created_at else '' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">No participants yet.</div>
{% endif %}
{% endblock %}
