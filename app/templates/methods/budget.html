{% extends "base.html" %}
{% block title %}Budget Allocation â€” {{ experiment.name }}{% endblock %}

{% block content %}
<h2>{{ method.display_name }}</h2>
<p>Distribute <strong>{{ total_points }} points</strong> among the risks. More points = higher risk priority.</p>

<form method="post" id="budgetForm">
    {% for param in parameters %}
    {% if mode == 'per_parameter' %}
    <h4 class="mt-4">Allocation for: {{ param }}</h4>
    {% endif %}

    <div class="budget-group mb-4" data-param="{{ param }}" data-total="{{ total_points }}">
        <div class="alert alert-info">
            Remaining: <strong class="remaining-points">{{ total_points }}</strong> / {{ total_points }} points
        </div>

        {% for risk in risks %}
        <div class="card mb-2">
            <div class="card-body d-flex align-items-center">
                <div class="flex-grow-1 me-3">
                    <strong>{{ risk.name }}</strong>
                    {% if risk.description %}
                    <br><small class="text-muted">{{ risk.description }}</small>
                    {% endif %}
                </div>
                <div style="width: 200px;">
                    <input type="range" class="form-range budget-slider" min="0" max="{{ total_points }}"
                           value="0" data-risk-id="{{ risk.id }}" data-param="{{ param }}">
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control budget-input"
                               name="points_{{ param }}_{{ risk.id }}"
                               min="0" max="{{ total_points }}" value="0"
                               data-risk-id="{{ risk.id }}" data-param="{{ param }}">
                        <span class="input-group-text">pts</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}

    <button type="submit" class="btn btn-primary btn-lg">Submit Allocation</button>
</form>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/budget.js') }}"></script>
{% endblock %}
